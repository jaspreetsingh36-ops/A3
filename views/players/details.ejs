<!-- Include header template -->
<%- include('../partials/header') %>

        <!-- Page header with player name and action buttons -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="display-5">Player Profile</h1>
            <div>
                <a href="/players" class="btn btn-secondary">Back to Squad</a>
                <a href="/players/new" class="btn btn-success">Add New Player</a>
            </div>
        </div>

        <!-- Main player profile card -->
        <div class="card">
            <!-- Card header with player name and role -->
            <div class="card-header bg-primary text-white">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h2 class="h4 mb-0">
                            <%= player.name %>
                            <% if (player.jerseyNumber) { %>
                                <small class="fs-6">#<%= player.jerseyNumber %></small>
                            <% } %>
                        </h2>
                    </div>
                    <div class="col-md-4 text-end">
                        <!-- Role badge with color coding -->
                        <span class="badge fs-6 
                            <%= player.role === 'Batsman' ? 'bg-success' : 
                                player.role === 'Bowler' ? 'bg-warning text-dark' : 
                                player.role === 'All-Rounder' ? 'bg-info' : 'bg-secondary' %>">
                            <%= player.role %>
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Card body with player statistics -->
            <div class="card-body">
                <!-- Career Overview Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4 class="border-bottom pb-2">Career Overview</h4>
                    </div>
                    
                    <!-- Matches Played Stat -->
                    <div class="col-md-3 col-6 text-center mb-3">
                        <div class="border rounded p-3 bg-light">
                            <h5 class="text-primary"><%= player.matches %></h5>
                            <small class="text-muted">Matches Played</small>
                        </div>
                    </div>
                    
                    <!-- Runs Scored Stat (show only if player has runs) -->
                    <% if (player.runs > 0) { %>
                        <div class="col-md-3 col-6 text-center mb-3">
                            <div class="border rounded p-3 bg-light">
                                <h5 class="text-success"><%= player.runs.toLocaleString() %></h5>
                                <small class="text-muted">Runs Scored</small>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- Wickets Taken Stat (show only if player has wickets) -->
                    <% if (player.wickets > 0) { %>
                        <div class="col-md-3 col-6 text-center mb-3">
                            <div class="border rounded p-3 bg-light">
                                <h5 class="text-danger"><%= player.wickets %></h5>
                                <small class="text-muted">Wickets Taken</small>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- Batting Average Stat (show only if average > 0) -->
                    <% if (player.average > 0) { %>
                        <div class="col-md-3 col-6 text-center mb-3">
                            <div class="border rounded p-3 bg-light">
                                <h5 class="text-info"><%= player.average %></h5>
                                <small class="text-muted">Batting Average</small>
                            </div>
                        </div>
                    <% } %>
                </div>

                <!-- Detailed Statistics Section -->
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-3">Batting Statistics</h5>
                        <table class="table table-sm">
                            <tbody>
                                <!-- Runs per match calculation -->
                                <tr>
                                    <td><strong>Runs per Match:</strong></td>
                                    <td>
                                        <%= (player.runs / player.matches).toFixed(2) %>
                                    </td>
                                </tr>
                                <!-- Strike Rate display -->
                                <% if (player.strikeRate > 0) { %>
                                    <tr>
                                        <td><strong>Strike Rate:</strong></td>
                                        <td><%= player.strikeRate %></td>
                                    </tr>
                                <% } %>
                                <!-- Batting Average display -->
                                <% if (player.average > 0) { %>
                                    <tr>
                                        <td><strong>Batting Average:</strong></td>
                                        <td><%= player.average %></td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="col-md-6">
                        <h5 class="mb-3">Bowling Statistics</h5>
                        <table class="table table-sm">
                            <tbody>
                                <!-- Wickets per match calculation -->
                                <% if (player.wickets > 0) { %>
                                    <tr>
                                        <td><strong>Wickets per Match:</strong></td>
                                        <td>
                                            <%= (player.wickets / player.matches).toFixed(2) %>
                                        </td>
                                    </tr>
                                <% } %>
                                <!-- Player role specific information -->
                                <tr>
                                    <td><strong>Primary Role:</strong></td>
                                    <td><%= player.role %></td>
                                </tr>
                                <!-- Jersey number display -->
                                <% if (player.jerseyNumber) { %>
                                    <tr>
                                        <td><strong>Jersey Number:</strong></td>
                                        <td>#<%= player.jerseyNumber %></td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Performance Analysis Section -->
                <div class="row mt-4">
                    <div class="col-12">
                        <h5 class="mb-3">Performance Analysis</h5>
                        <div class="progress mb-2" style="height: 25px;">
                            <!-- Batting contribution progress bar -->
                            <div class="progress-bar bg-success" 
                                 style="width: <%= Math.min((player.runs / 10000) * 100, 100) %>%">
                                Batting: <%= player.runs.toLocaleString() %> runs
                            </div>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <!-- Bowling contribution progress bar -->
                            <div class="progress-bar bg-warning" 
                                 style="width: <%= Math.min((player.wickets / 500) * 100, 100) %>%">
                                Bowling: <%= player.wickets %> wickets
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Card footer with action buttons -->
            <div class="card-footer">
                <div class="d-flex gap-2">
                    <!-- Edit player button -->
                    <a href="/players/<%= player._id %>/edit" class="btn btn-warning">
                        Edit Player Stats
                    </a>
                    
                    <!-- Delete player button with modal trigger -->
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                        Remove from Team
                    </button>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- Modal header -->
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Confirm Player Removal</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    
                    <!-- Modal body with warning message -->
                    <div class="modal-body">
                        <p>Are you sure you want to remove <strong><%= player.name %></strong> from the team?</p>
                        <div class="alert alert-warning">
                            <strong>Warning:</strong> This will permanently delete all statistics for this player.
                        </div>
                    </div>
                    
                    <!-- Modal footer with action buttons -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <!-- Delete form -->
                        <form method="POST" action="/players/<%= player._id %>/delete" style="display: inline;">
                            <button type="submit" class="btn btn-danger">Yes, Remove Player</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

<!-- Include footer template -->
<%- include('../partials/footer') %>
